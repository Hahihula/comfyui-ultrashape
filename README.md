# ComfyUI-UltraShape

A ComfyUI wrapper for UltraShape-1.0: High-Fidelity 3D Shape Generation via Scalable Geometric Refinement.

## Overview

This repository provides ComfyUI nodes to integrate UltraShape-1.0 with existing 3D generation workflows. UltraShape implements a two-stage pipeline:
1. **Coarse Generation**: Uses Hunyuan3D-2.1 to generate an initial coarse mesh from an image
2. **Refinement Stage**: Uses UltraShape's DiT (Diffusion Transformer) model to refine the coarse mesh with geometric details

## Features

- `LoadUltraShapeModel`: Loads the UltraShape model for refinement
- `UltraShapeRefine`: Refines a coarse mesh using UltraShape with a specified path
- `UltraShapeRefineFromHunyuan`: Refines a mesh generated by Hunyuan3D using UltraShape

## Installation

### Prerequisites

- Docker
- NVIDIA GPU with CUDA support

### Setup

1. Clone this repository:
   ```bash
   git clone https://github.com/hahihula/ComfyUI-UltraShape-1.0.git
   cd ComfyUI-UltraShape-1.0
   ```

2. Build the Docker image:
   ```bash
   docker build -t comfyui-ultrashape .
   ```

3. Run the ComfyUI server:
   ```bash
   docker run -it -p 8188:8188 --gpus all comfyui-ultrashape
   ```

## Models Required

You need to download the following models:

1. **Hunyuan3D-2.1**:
   - `hunyuan_3d_v2.1.safetensors` - [Download](https://huggingface.co/Comfy-Org/hunyuan3D_2.1_repackaged/resolve/main/hunyuan_3d_v2.1.safetensors)
   - Place in `ComfyUI/models/checkpoints/`

2. **UltraShape**:
   - `ultrashape_v1.pt` - [Download](https://huggingface.co/infinith/UltraShape/resolve/main/ultrashape_v1.pt)
   - Place in `ComfyUI/models/ultrashape/`

## Usage

### Using the Workflow

1. Open ComfyUI in your browser at `http://localhost:8188`
2. Load the example workflow: `example_workflows/3d_hunyuan3d-ultrashape-v2.1.json`
3. Add your input image to the `LoadImage` node
4. Connect the workflow and run it

The workflow will:
1. Generate a coarse mesh using Hunyuan3D-2.1
2. Refine the mesh using UltraShape-1.0
3. Output the final refined mesh

### Custom Nodes

#### LoadUltraShapeModel
- Loads the UltraShape model from the specified checkpoint and config
- Outputs: `ultrashape_model`

#### UltraShapeRefineFromHunyuan
- Takes a Hunyuan3D mesh and refines it using UltraShape
- Inputs: `ultrashape_model`, `image`, `hunyuan_mesh`
- Outputs: `refined_mesh`, `output_path`

## Docker Configuration

The Dockerfile includes:
- Base ComfyUI environment with CUDA support
- UltraShape dependencies
- Custom ComfyUI nodes
- Required Python packages

## Project Structure

```
ComfyUI-UltraShape-1.0/
├── Dockerfile              # Docker configuration
├── ultrashape_repo/        # UltraShape-1.0 submodule
├── custom_nodes/           # ComfyUI custom nodes
│   └── ComfyUI-UltraShape/
│       └── __init__.py     # Node implementations
├── example_workflows/      # Example workflow files
│   ├── 3d_hunyuan3d-v2.1.json
│   └── 3d_hunyuan3d-ultrashape-v2.1.json
└── README.md
```

## License

This wrapper is provided under the same license as the original UltraShape-1.0 repository. Please check the original repository for licensing information.

## Acknowledgements

- [UltraShape-1.0](https://github.com/PKU-YuanGroup/UltraShape-1.0) - The core 3D refinement technology
- [Hunyuan3D-2.1](https://github.com/Tencent-Hunyuan/Hunyuan3D-2.1) - For the initial 3D generation
- [ComfyUI](https://github.com/comfyanonymous/ComfyUI) - The workflow framework